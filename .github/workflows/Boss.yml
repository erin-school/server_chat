name: Discord Boss Alert (๋ณด์ค ์๋ฆผ)

on:
  schedule:
    - cron: "55-59 11,17,19,21 * * *"  # 11,17,19,21์ 55~59๋ถ ๋งค๋ถ ์คํ
  workflow_dispatch:

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Send boss alert
        run: |
          KST_HOUR=$(date -d '+9 hours' '+%H')
          KST_MINUTE=$(date -d '+9 hours' '+%M')
          NOW_KST=$(date -d '+9 hours' '+%Y-%m-%d %H:%M:%S')

          # ์๋ฉด ์๊ฐ 23~08์ ์์ธ
          if [ "$KST_HOUR" -ge 23 ] || [ "$KST_HOUR" -lt 8 ]; then
            echo "๐ค ์๋ฉด ์๊ฐ: ์๋ฆผ ์๋ต (${KST_HOUR}:${KST_MINUTE})"
            exit 0
          fi

          # ๋ณด์ค ์๋ฆผ: 55~59๋ถ ์ฌ์ด ๋ฐ์ก
          if [ "$KST_MINUTE" -ge 55 ] && [ "$KST_MINUTE" -le 59 ]; then
            case "$KST_HOUR" in
              "11")
                MESSAGE="[โฐ ์ค์ 11:58] ์ธ์ฅ ํ๋ฐ์ ์ํด ๊ผญ ํ๋ฆฌ ๋งค์ฐ ์ด๋ค์, ํ๋ฅด๋ชจ๊ทธ ์ผ๋ฐ/์ด๋ค์์ ํ๋ฒ์ฉ ๋์์ฃผ์ธ์."
                EMBED_COLOR=1127128
                ;;
              "17")
                MESSAGE="[โฐ ์คํ 5:58] ์ธ์ฅ ํ๋ฐ์ ์ํด ๊ผญ ํ๋ฆฌ ๋งค์ฐ ์ด๋ค์, ํ๋ฅด๋ชจ๊ทธ ์ผ๋ฐ/์ด๋ค์์ ํ๋ฒ์ฉ ๋์์ฃผ์ธ์."
                EMBED_COLOR=14177041
                ;;
              "19")
                MESSAGE="[โฐ ์คํ 7:58] ์ธ์ฅ ํ๋ฐ์ ์ํด ๊ผญ ํ๋ฆฌ ๋งค์ฐ ์ด๋ค์, ํ๋ฅด๋ชจ๊ทธ ์ผ๋ฐ/์ด๋ค์์ ํ๋ฒ์ฉ ๋์์ฃผ์ธ์."
                EMBED_COLOR=16753920
                ;;
              "21")
                MESSAGE="[โฐ ์คํ 9:58] ์ธ์ฅ ํ๋ฐ์ ์ํด ๊ผญ ํ๋ฆฌ ๋งค์ฐ ์ด๋ค์, ํ๋ฅด๋ชจ๊ทธ ์ผ๋ฐ/์ด๋ค์์ ํ๋ฒ์ฉ ๋์์ฃผ์ธ์."
                EMBED_COLOR=3447003
                ;;
              *)
                echo "์๋ฆผ ๋์ ์๊ฐ์ด ์๋"
                exit 0
                ;;
            esac

            EMBED_TITLE="ํ๋ ๋ณด์ค๊ฐ ๊ณง ๋ฑ์ฅ ํฉ๋๋ค."

            PAYLOAD=$(jq -n \
              --arg content "$MESSAGE" \
              --arg title "$EMBED_TITLE" \
              --arg description "ํ์ฌ ์๊ฐ: $NOW_KST" \
              --argjson color "$EMBED_COLOR" \
              --arg footer "ํด๋น ์๋ฆผ์ ์๋ฉด ์๊ฐ ๋ณด์ฅ์ ์ํด ์๋ 11์๋ถํฐ ๋ค์๋ 8์๊น์ง๋ ๋ฐ์ก๋์ง ์์ต๋๋ค." \
              '{
                content: $content,
                embeds: [
                  {
                    title: $title,
                    description: $description,
                    color: $color,
                    footer: {text: $footer}
                  }
                ]
              }')

            curl -H "Content-Type: application/json" \
              -X POST \
              -d "$PAYLOAD" \
              ${{ secrets.DISCORD_WEBHOOK_URL }}

          else
            echo "์๋ฆผ ๋์ ์๊ฐ์ด ์๋"
            exit 0
          fi
