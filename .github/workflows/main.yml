name: Discord Hourly Alert (ê²°ê³„ ì•Œë¦¼)

on:
  schedule:
    - cron: "0 * * * *"  # ë§¤ì‹œ ì •ê°
  workflow_dispatch:

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Send hourly alert
        run: |
          KST_HOUR=$(date -d '+9 hours' '+%H')
          KST_MINUTE=$(date -d '+9 hours' '+%M')
          NOW_KST=$(date -d '+9 hours' '+%Y-%m-%d %H:%M:%S')

          # ìˆ˜ë©´ ì‹œê°„ 23~08ì‹œ ì œì™¸
          if [ "$KST_HOUR" -ge 23 ] || [ "$KST_HOUR" -lt 8 ]; then
            echo "ğŸ’¤ ìˆ˜ë©´ ì‹œê°„: ì•Œë¦¼ ìƒëµ (${KST_HOUR}:${KST_MINUTE})"
            exit 0
          fi

          MESSAGE="ğŸ’« ì—ë¦° ì„¸ê³„ì— ìƒˆë¡œìš´ ê²°ê³„ê°€ ìƒì„±ë˜ëŠ” ì¤‘ ì…ë‹ˆë‹¤. ìŠì§€ë§ê³  ì°¸ì—¬í•©ì‹œë‹¤!"
          EMBED_TITLE="ìƒˆë¡œìš´ ê²°ê³„ ê°ì§€ ë¨!!"
          EMBED_COLOR=7506394

          PAYLOAD=$(jq -n \
            --arg content "$MESSAGE" \
            --arg title "$EMBED_TITLE" \
            --arg description "í˜„ì¬ ì‹œê°: $NOW_KST" \
            --argjson color "$EMBED_COLOR" \
            --arg footer "í•´ë‹¹ ì•Œë¦¼ì€ ìˆ˜ë©´ ì‹œê°„ ë³´ì¥ì„ ìœ„í•´ ì €ë… 11ì‹œë¶€í„° ë‹¤ìŒë‚  8ì‹œê¹Œì§€ëŠ” ë°œì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤." \
            '{
              content: $content,
              embeds: [
                {
                  title: $title,
                  description: $description,
                  color: $color,
                  footer: {text: $footer}
                }
              ]
            }')

          curl -H "Content-Type: application/json" \
            -X POST \
            -d "$PAYLOAD" \
            ${{ secrets.DISCORD_WEBHOOK_URL }}
