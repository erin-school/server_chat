name: Discord Time Alerts (Accurate)

on:
  schedule:
    - cron: "*/1 * * * *"  # ë§¤ë¶„ ì‹¤í–‰
  workflow_dispatch:

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Send accurate alert
        run: |
          KST_HOUR=$(date -d '+9 hours' '+%H')
          KST_MINUTE=$(date -d '+9 hours' '+%M')

          echo "í˜„ì¬ ì‹œê°„ (KST): ${KST_HOUR}:${KST_MINUTE}"

          if [ "$KST_MINUTE" == "58" ]; then
            if [ "$KST_HOUR" == "11" ]; then
              MESSAGE="â° ì•„ ë§ë‹¤! í•„ë“œ ë³´ìŠ¤~!!! (ì˜¤ì „ 11:58)"
              EMBED_TITLE="ğŸŒ ì˜¤ì „ 11ì‹œ 58ë¶„"
              EMBED_COLOR=1127128
            elif [ "$KST_HOUR" == "17" ]; then
              MESSAGE="â° ì•„ ë§ë‹¤! í•„ë“œ ë³´ìŠ¤~!!! (ì˜¤í›„ 5:58)"
              EMBED_TITLE="ğŸŒ‡ ì˜¤í›„ 5ì‹œ 58ë¶„"
              EMBED_COLOR=14177041
            elif [ "$KST_HOUR" == "19" ]; then
              MESSAGE="â° ì•„ ë§ë‹¤! í•„ë“œ ë³´ìŠ¤~!!! (ì˜¤í›„ 7:58)"
              EMBED_TITLE="ğŸŒ† ì˜¤í›„ 7ì‹œ 58ë¶„"
              EMBED_COLOR=16753920
            elif [ "$KST_HOUR" == "21" ]; then
              MESSAGE="â° ì•„ ë§ë‹¤! í•„ë“œ ë³´ìŠ¤~!!! (ì˜¤í›„ 9:58)"
              EMBED_TITLE="ğŸŒ™ ì˜¤í›„ 9ì‹œ 58ë¶„"
              EMBED_COLOR=3447003
            else
              MESSAGE="â° ì•„ ë§ë‹¤! ê²°ê³„!"
              EMBED_TITLE="ğŸ’« ë§¤ì‹œ 58ë¶„ ì•Œë¦¼"
              EMBED_COLOR=7506394
            fi

            PAYLOAD=$(jq -n \
              --arg content "$MESSAGE" \
              --arg title1 "Meow!" \
              --argjson color1 1127128 \
              --arg title2 "Meow-meow!" \
              --argjson color2 14177041 \
              --arg alert_title "$EMBED_TITLE" \
              --argjson alert_color "$EMBED_COLOR" \
              '{
                content: $content,
                embeds: [
                  {title: $title1, color: $color1},
                  {title: $title2, color: $color2},
                  {title: $alert_title, color: $alert_color}
                ]
              }')

            curl -H "Content-Type: application/json" \
              -X POST \
              -d "$PAYLOAD" \
              ${{ secrets.DISCORD_WEBHOOK_URL }}
          else
            echo "â³ ì•„ì§ ì•Œë¦¼ ì‹œê°ì´ ì•„ë‹˜ (${KST_HOUR}:${KST_MINUTE})"
          fi
