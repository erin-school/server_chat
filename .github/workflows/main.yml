name: Discord Time Alerts (Accurate)

on:
  schedule:
    - cron: "*/1 * * * *"  # 매분 실행
  workflow_dispatch:

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Send accurate alert
        run: |
          KST_HOUR=$(date -d '+9 hours' '+%H')
          KST_MINUTE=$(date -d '+9 hours' '+%M')

          echo "현재 시간 (KST): ${KST_HOUR}:${KST_MINUTE}"

          if [ "$KST_MINUTE" == "58" ]; then
            if [ "$KST_HOUR" == "11" ]; then
              MESSAGE="⏰ 아 맞다! 필드 보스~!!! (오전 11:58)"
            elif [ "$KST_HOUR" == "17" ]; then
              MESSAGE="⏰ 아 맞다! 필드 보스~!!! (오후 5:58)"
            elif [ "$KST_HOUR" == "19" ]; then
              MESSAGE="⏰ 아 맞다! 필드 보스~!!! (오후 7:58)"
            elif [ "$KST_HOUR" == "21" ]; then
              MESSAGE="⏰ 아 맞다! 필드 보스~!!! (오후 9:58)"
            else
              MESSAGE="⏰ 아 맞다! 결계!"
            fi

            curl -H "Content-Type: application/json" \
              -X POST \
              -d "{\"content\":\"$MESSAGE\"}" \
              ${{ secrets.DISCORD_WEBHOOK_URL }}
          else
            echo "⏳ 아직 알림 시각이 아님 (${KST_HOUR}:${KST_MINUTE})"
          fi
