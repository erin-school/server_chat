name: Notice

on:
  workflow_dispatch: {}  # 수동 실행 전용

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Send notice embed
        run: |
          TITLE="파티에 가입된 상태에서 '크로스 서버 비공개 채널 생성기' 사용 시 비공개 채널이 생성되지 않으며 아이템이 소모되는 현상"
          DESCRIPTION="파티 가입이 되지 않은 상태에서 아이템 사용을 시도해 주시길 바랍니다. 소모된 아이템은 추후 현상이 발생한 캐릭터의 우편함으로 지급될 예정입니다."
          URL=""
          FOOTER="[공식] 확인 중인 현상"
          COLOR=16753920

          # 줄바꿈 escape 처리
          ESCAPED_DESC=$(printf '%s %s' "$DESCRIPTION" "$URL" | sed ':a;N;$!ba;s/\n/\\n/g')

          PAYLOAD=$(jq -n \
            --arg title "$TITLE" \
            --arg description "$ESCAPED_DESC" \
            --argjson color "$COLOR" \
            --arg footer "$FOOTER" \
            '{
              embeds: [
                {
                  title: $title,
                  description: $description,
                  color: $color,
                  footer: {text: $footer}
                }
              ]
            }')

          # secrets 사용 시 반드시 따옴표로 감싸기
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$PAYLOAD" \
               "${{ secrets.DISCORD_WEBHOOK_URL_NOTICE }}"
