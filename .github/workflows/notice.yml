name: Notice

on:
  workflow_dispatch: {}  # 수동 실행 전용

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Send notice embed
        run: |
          TITLE="11/4(화) 임시점검 안내 (15:00 ~ 17:30)"
          DESCRIPTION="연이은 서버 불안정 현상과 임시점검으로 게임 이용에 불편을 드려 죄송합니다."
          URL="https://mabinogimobile.nexon.com/News/Notice/3210455"
          FOOTER="[공식] 점검 안내"
          COLOR=16753920

          # 줄바꿈 escape 처리
          ESCAPED_DESC=$(printf '%s %s' "$DESCRIPTION" "$URL" | sed ':a;N;$!ba;s/\n/\\n/g')

          PAYLOAD=$(jq -n \
            --arg title "$TITLE" \
            --arg description "$ESCAPED_DESC" \
            --argjson color "$COLOR" \
            --arg footer "$FOOTER" \
            '{
              embeds: [
                {
                  title: $title,
                  description: $description,
                  color: $color,
                  footer: {text: $footer}
                }
              ]
            }')

          # secrets 사용 시 반드시 따옴표로 감싸기
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$PAYLOAD" \
               "${{ secrets.DISCORD_WEBHOOK_URL_NOTICE }}"
