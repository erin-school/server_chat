name: Notice

on:
  workflow_dispatch: {}  # 수동 실행 전용

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Send notice embed
        run: |
          TITLE="캐릭터 접속 시, 간헐적으로 공지사항 화면이 하얗게 변하며 접속이 불가능한 현상"
          DESCRIPTION="해당 현상 발생 시, 게임을 완전히 종료한 이후 재접속을 부탁드립니다."
          URL=""
          FOOTER="[공식] 확인 중인 현상"
          COLOR=16753920

          # 줄바꿈 escape 처리
          ESCAPED_DESC=$(printf '%s %s' "$DESCRIPTION" "$URL" | sed ':a;N;$!ba;s/\n/\\n/g')

          PAYLOAD=$(jq -n \
            --arg title "$TITLE" \
            --arg description "$ESCAPED_DESC" \
            --argjson color "$COLOR" \
            --arg footer "$FOOTER" \
            '{
              embeds: [
                {
                  title: $title,
                  description: $description,
                  color: $color,
                  footer: {text: $footer}
                }
              ]
            }')

          # secrets 사용 시 반드시 따옴표로 감싸기
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$PAYLOAD" \
               "${{ secrets.DISCORD_WEBHOOK_URL_NOTICE }}"
