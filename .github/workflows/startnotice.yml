name: Service Maintenance Notice

on:
  schedule:
    # 오늘 11월 3일 오전 9시 KST = 2025-11-03 00:00 UTC
    - cron: '0 0 3 11 *'  # UTC 기준 → KST 09:00
  workflow_dispatch: {}  # 수동 실행 가능

jobs:
  send_notice:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Send Discord embed
        run: |
          TITLE="서비스 점검 시작"
          DESCRIPTION="서비스 점검이 시작되어 게임에 접속 할 수 없습니다. 점검이 완료되면 다시 알림을 발송합니다."
          FOOTER="완료 시간과 공지 업로드 시간이 다를 경우 알림이 전달되지 않을 수 있습니다."
          COLOR=16753920

          # 줄바꿈 escape 처리
          ESCAPED_DESC=$(printf '%s' "$DESCRIPTION" | sed ':a;N;$!ba;s/\n/\\n/g')

          PAYLOAD=$(jq -n \
            --arg title "$TITLE" \
            --arg description "$ESCAPED_DESC" \
            --argjson color "$COLOR" \
            --arg footer "$FOOTER" \
            '{
              embeds: [
                {
                  title: $title,
                  description: $description,
                  color: $color,
                  footer: {text: $footer}
                }
              ]
            }')

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$PAYLOAD" \
               "${{ secrets.DISCORD_WEBHOOK_URL_NOTICE }}"
